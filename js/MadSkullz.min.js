// NFT Viewer for @MadSkullz_NFT
// Author: @entropy_8_

function get_query_params(){const e=new URL(this.document.URL),t=e.search.split("?")[1];if(t){params=new URLSearchParams(t);for(let e of params.entries()){let t={key:e[0].toLowerCase(),value:e[1].toLowerCase()};return t}}}function process_params(e){if(null==e)return;let t=document.getElementById("token-id");"skullz"===e.key?t.value=e.value:"token"===e.key?t.value=e.value+"t":"rank"===e.key&&(t.value=e.value+"r"),get_nft_attr(!0)}function get_nft_attr(e=!1){let t=void 0,n=void 0,d=document.getElementById("token-id"),s=d.value,a=s.match(/^t\d{1,4}/i),l=s.match(/^\d{1,4}t/i),r=a||l;a?s=a[0].replace(/\D/g,""):l&&(s=l[0].replace(/\D/g,""));let i=s.match(/^r\d{1,4}/i)||s.match(/^\d{1,4}r/i);if(document.getElementById("token-unrevealed").classList.add("hidden"),document.getElementById("token-not-found").classList.add("hidden"),r)n=trim_zeros(s),null!=SKULLZ_IDS[n]?t=pad_zeros(SKULLZ_IDS[n]):(document.getElementById("missing-onez").innerText=`${n}`,document.getElementById("token-unrevealed").classList.remove("hidden"),document.getElementById("token-not-found").classList.add("hidden"));else if(i){const e=s.replace(/\D/g,"");if(t=search_rank(e),null==t)return document.getElementById("token-not-found").classList.remove("hidden"),document.getElementById("token-unrevealed").classList.add("hidden"),document.getElementById("skullz-info").classList.add("hidden"),void document.getElementById("skullz-list-box").classList.add("hidden");t=pad_zeros(t),n=search_token_index(t)}else s=s.replace(/\D/g,""),t=pad_zeros(s),n=search_token_index(t);const o=document.getElementById("token-index");null!=t?(document.getElementById("skullz-id").innerText=t,e&&(document.getElementById("skullz-count-header").innerHTML="",document.getElementById("skullz-list").innerHTML=""),fetch_nft_attr(t),document.getElementById("skullz-info").classList.remove("hidden"),document.getElementById("skullz-list-box").classList.remove("hidden"),-1!=n?(o.innerText=`#${n}`,document.getElementById("snowtrace-url").href=`https://snowtrace.io/token/0x3025c5c2aa6eb7364555aac0074292195701bbd6?a=${n}`,document.getElementById("kalao-url").href=`https://marketplace.kalao.io/nft/0x3025c5c2aa6eb7364555aac0074292195701bbd6_${n}`,document.getElementById("joepegs-url").href=`https://joepegs.com/item/0x3025c5c2aa6eb7364555aac0074292195701bbd6/${n}`,document.getElementById("opensea-url").href=`https://opensea.io/assets/avalanche/0x3025c5c2aa6eb7364555aac0074292195701bbd6/${n}`,document.getElementById("campfire-url").href=`https://campfire.exchange/collections/0x3025c5c2aa6eb7364555aac0074292195701bbd6/${n}`,document.getElementById("nftrade-url").href=`https://nftrade.com/assets/avalanche/0x3025c5c2aa6eb7364555aac0074292195701bbd6/${n}`,document.getElementById("snowtrace-url").hidden=!1,document.getElementById("kalao-url").hidden=!1,document.getElementById("joepegs-url").hidden=!1,document.getElementById("opensea-url").hidden=!1,document.getElementById("nftrade-url").hidden=!1):(console.log(`Token of Skullz #${t} is still hidden in The Missing Onez.`),o.innerText="Unrevealed (Missing Onez)",document.getElementById("snowtrace-url").hidden=!0,document.getElementById("kalao-url").hidden=!0,document.getElementById("joepegs-url").hidden=!0,document.getElementById("opensea-url").hidden=!0,document.getElementById("nftrade-url").hidden=!0)):(console.log(`Token #${n} is still hidden in The Missing Onez.`),document.getElementById("skullz-info").classList.add("hidden"),document.getElementById("skullz-list-box").classList.add("hidden"))}function fetch_nft_attr(e){const t=base_url+e+".json";let n=new XMLHttpRequest;n.open("GET",t,!0),n.onreadystatechange=function(){if(4==this.readyState&&200==this.status){let e=JSON.parse(this.responseText),t=document.getElementById("rarity");t.classList.remove("rarity-great","rarity-rare","rarity-epic","rarity-legendary","rarity-forgottenz","rarity-creatorz"),t.classList.add("rarity-"+e.rarity.toLowerCase()),t.innerText=e.rarity,document.getElementById("rank").innerText=e.rank,document.getElementById("img").setAttribute("src",e.image);let n=document.getElementById("skullz-traits");n.innerHTML="";e.attributes.forEach(function(e,t,d){if("Rarity"===e.trait_type)return;const s=e.trait_type,a=e.value,l=e.rarity;let r={};r[s]=a;let i=n.insertRow();i.classList.add("traits-row");let o=i.insertCell();o.classList.add("traits-cell"),o.appendChild(document.createTextNode(s)),o=i.insertCell(),o.classList.add("traits-cell","trait-value","right","padding-right-075");let c=document.createElement("div");if(c.innerText=a,o.appendChild(c),c.addEventListener("click",function(){set_selected(this.closest(".traits-row"));const e=search_traits(r);show_traits_list(a,l,e)}),null!=e.rarity){const e=SKULLZ_TRAITS[s][a].count,t=(100*e/NFT_count).toFixed(2),n=(100/e).toFixed(1);o=i.insertCell(),o.classList.add("traits-cell","rarity-"+l.toLowerCase()),o.appendChild(document.createTextNode(l)),o=i.insertCell(),o.classList.add("traits-cell","right"),o.appendChild(document.createTextNode(`${n}%`)),o=i.insertCell(),o.classList.add("traits-cell","right"),o.appendChild(document.createTextNode(`${t}%`))}})}},n.send()}function search_token_index(e){for(const t in SKULLZ_IDS)if(SKULLZ_IDS[t]==e)return t;return-1}function search_traits(e){let t=[];const n=Object.keys(e),d=e[n];for(const e in SKULLZ_DATA)SKULLZ_DATA[e].attributes.forEach(function(s,a,l){s.trait_type==n&&s.value==d&&t.push(e)});return t}function search_rank(e){let t=void 0;for(const n in SKULLZ_DATA)SKULLZ_DATA[n].rank==e&&(t=n);return t}function show_traits_list(e,t,n){let d=document.getElementById("skullz-list");d.innerHTML="";const s="rarity-"+t.toLowerCase();let a=document.getElementById("skullz-count-header");a.innerHTML=`Total Skullz with <span class="${s} rarity">${e}</span>: <span class="counter">${n.length}</span>`,n.forEach(function(e,t,n){const s=SKULLZ_DATA[e];let a=document.createElement("div");a.classList.add("skullz-list-item","center");const l="rarity-"+s.rarity.toLowerCase();a.innerHTML=`<div class="${l} rank">${s.rank}</div> <span class="underline">Skullz #${pad_zeros(e)}</span>`,d.appendChild(a),a.addEventListener("click",function(){set_selected(this),document.getElementById("token-id").value=e,document.getElementById("skullz-id").innerText=e,get_nft_attr(),document.getElementById("skullz-id").scrollIntoView()})})}function set_selected(e){const t=document.getElementsByClassName("selected");for(let e=0;e<t.length;e++)t[e].classList.remove("selected");e.classList.add("selected")}function pad_zeros(e){return("0000"+e).slice(-4)}function trim_zeros(e){return e.replace(/^0+/,"")}const base_url="https://cdn.madskullz.io/madskullz/metadata/",NFT_count=6666;window.addEventListener("load",function(){process_params(get_query_params());const e=document.getElementById("token-id");e.focus(),e.addEventListener("keydown",function(e){"Enter"==e.key&&get_nft_attr(!0)});const t=document.getElementById("theme-btn");t.addEventListener("click",function(){document.body.classList.contains("dark")?(t.src="./images/dark.svg",document.body.classList.remove("dark")):(t.src="./images/light.svg",document.body.classList.add("dark"))})});